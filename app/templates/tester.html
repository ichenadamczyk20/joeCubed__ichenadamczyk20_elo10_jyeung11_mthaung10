<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8" />
        <title>Log In â€” Ample Examples</title>
        <link rel="stylesheet" href="/static/css/styles.css">
    </head>

    <body>
        <h1 class="title">Log In!</h1>
        <div class="grid-container">
            <div class="grid-x grid-margin-x">
				<p class="error-msg">{{ error_msg }}</p>
                <p class="success-msg">{{ success_msg }}</p>
                <!-- sends the form element to "submitThis" and cancels HTML default response -->
                <form action="/login-submit" onsubmit="submitThis(this); return false;" method="POST">
                    <label for="username">Username *</label>
                    <input type="text" name="username" id="username" required />

                    <label for="password">Password *</label>
                    <input type="password" name="password" id="password" required />
                    
                    <input name="login" type="submit" value="Log In" />
                    <p>Not registered? <a href="/register">Register here.</a></p>
                </form>
			</div>
		</div>
    </body>

    <script>
        function submitThis(form) {
            if (window.XMLHttpRequest) {
                //Firefox, Opera, IE7, and other browsers will use the native object
                var xhttp = new XMLHttpRequest();
            } else {
                //IE 5 and 6 will use the ActiveX control
                var xhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            var submitButton = form.querySelector('[type=submit]'); //finds the submit button to disable it so people can't spam the form
            submitButton.disabled = true;
            xhttp.onreadystatechange = function() { //handles the response from the submit target
                var json = JSON.parse(xhttp.responseText)
                if (json["error"]) document.querySelector('.error-msg').innerHTML = json["error"];
                if (json["success"]) document.querySelector('.success-msg').innerHTML = json["success"];
                submitButton.disabled = false;
            };
            xhttp.open("POST", "/login-submit", true); //sends to /login-submit via POST
            xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); //encodes in URL as the HTML form would
            var data = new FormData(form); //gets the form's data
            var obj = Object.fromEntries(data.entries()); //converts the form data into an object
            var str = ""; //converts the object into URL-encoded data
            for (var key in obj) {
                if (str != "") {
                    str += "&";
                }
                str += key + "=" + encodeURIComponent(obj[key]);
            }
            xhttp.send(str); //sends the form
            return false;
        }
    </script>
</html>